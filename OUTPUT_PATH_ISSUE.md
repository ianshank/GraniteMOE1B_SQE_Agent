# Output Path Issue Analysis

## Issue Summary

The test cases generated by the Granite MOE Test Generator are being written to the `granite-test-generator/output` directory instead of the root project's `output` directory. This is causing confusion when checking for test case outputs in the root project's output directory.

## Root Cause Analysis

After investigating the code and directory structure, I've identified the following causes:

1. **Working Directory Change**: 
   - In `main.py` (line 50), there's an explicit `os.chdir(granite_dir)` call that changes the working directory to the `granite-test-generator` subdirectory.
   - This is done to ensure proper path resolution for imports and resources within the granite-test-generator package.

2. **Relative Path Usage**:
   - In `constants.py`, `DEFAULT_OUTPUT_DIR` is defined as simply "output" (a relative path).
   - When this relative path is used after the working directory has been changed to `granite-test-generator`, it resolves to `granite-test-generator/output`.

3. **Path Resolution**:
   - The `Path(output_dir_path)` call in `main.py` (line 542) creates a path object using the relative path "output".
   - Since the working directory is now `granite-test-generator`, this resolves to `granite-test-generator/output`.

## Evidence

1. **File Timestamps**:
   - Files in `/Users/iancruickshank/GraniteMOE1B_SQE_Agent/output` were last modified on September 28, 2025
   - Files in `/Users/iancruickshank/GraniteMOE1B_SQE_Agent/granite-test-generator/output` were modified today (September 29, 2025)

2. **File Content**:
   - Files in the root `output` directory are empty (contain just `[]`)
   - Files in the `granite-test-generator/output` directory contain actual test case data

3. **Code Analysis**:
   - The `os.chdir(granite_dir)` call in `main.py` explicitly changes the working directory
   - The `DEFAULT_OUTPUT_DIR` constant is defined as a relative path "output"
   - The output directory is created using `Path(output_dir_path)` which resolves relative to the current working directory

## Solution Options

1. **Use Absolute Paths**:
   - Modify `constants.py` to use absolute paths for `DEFAULT_OUTPUT_DIR`
   - Example: `DEFAULT_OUTPUT_DIR = str(Path(__file__).parent.parent.parent.parent / "output")`

2. **Restore Working Directory**:
   - Save the original working directory before changing it
   - Restore it before writing output files
   - Example:
     ```python
     original_dir = os.getcwd()
     os.chdir(granite_dir)
     # ... processing ...
     os.chdir(original_dir)  # Restore before writing files
     ```

3. **Output Path Parameter**:
   - Add a command-line parameter or environment variable to explicitly set the output directory
   - This would allow users to specify whether they want output in the root or the subdirectory

## Recommended Solution

The recommended solution is to use absolute paths for output directories. This provides the most clarity and avoids issues with changing working directories:

```python
# In constants.py
DEFAULT_OUTPUT_DIR = str(Path(__file__).parent.parent.parent.parent / "output")
```

This ensures that regardless of the current working directory, files will always be written to the root project's output directory.

## Additional Considerations

1. **Documentation**: Update documentation to clearly specify where output files are written.

2. **Configuration**: Consider adding an explicit configuration option for the output directory path.

3. **Symlink**: As a quick workaround, you could create a symbolic link between the two output directories:
   ```bash
   ln -s /Users/iancruickshank/GraniteMOE1B_SQE_Agent/granite-test-generator/output/* /Users/iancruickshank/GraniteMOE1B_SQE_Agent/output/
   ```

4. **Environment Variable**: Add an environment variable like `GRANITE_OUTPUT_DIR` that can override the default output location.
